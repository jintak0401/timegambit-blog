---
title: '[async/await] ES5ë¡œ ì œë„ˆë ˆì´í„° êµ¬í˜„í•˜ê¸°(1)'
date: '2023-01-22'
lastmod: '2023-01-22'
tags: ['JavaScript', 'async/await']
draft: false
series: ë™ì‘ì›ë¦¬
summary: ì œëŸ¬ë„¤ì´í„°ê°€ ES5 ë¬¸ë²•ìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ìˆëŠ”ì§€ ë¶„ì„í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” êµ¬í˜„ ê³¼ì •ì—ì„œ ì •ì˜ëœ ê°ì²´ë“¤ê°„ì˜ ê´€ê³„ë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
images: [https://i.imgur.com/iUAffAG.png]
layout: PostLayout
---

## ë¶„ì„í•˜ê¸° ì•ì„œ
[ì €ë²ˆ í¬ìŠ¤íŠ¸](https://www.timegambit.com/blog/digging/async-await/01)ì—ì„œ async/awaitê°€ ì œë„ˆë ˆì´í„°ë¥¼ ì´ìš©í•´ êµ¬í˜„ë˜ì–´ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì œë„ˆë ˆì´í„°ë„ ES5 ë¬¸ë²•ì€ ì•„ë‹™ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì œë„ˆë ˆì´í„°ê°€ ES5 ë¬¸ë²•ìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ìˆëŠ”ì§€ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤. ì „ì²´ ì½”ë“œë¥¼ ë¶„ì„í•˜ê¸°ì—ëŠ” ë§¤ìš° ê¸¸ì–´ì„œ ë§ì€ ì½”ë“œë¥¼ ìƒëµí•˜ì—¬ ì„¤ëª…í•  ì˜ˆì •ì…ë‹ˆë‹¤. ì „ì²´ ì½”ë“œë¥¼ ë³´ê³  ì‹¶ìœ¼ì‹œë©´ [Babel ì˜¨ë¼ì¸ íŠ¸ëœìŠ¤íŒŒì¼ëŸ¬](https://babeljs.io/repl)ì—ì„œ TARGETSë¥¼ ie 11ë¡œ ì„¤ì •í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ 8ì¤„ì§œë¦¬ ì½”ë“œê°€ 557ì¤„ì§œë¦¬ ì½”ë“œë¡œ ë»¥íŠ€ê¸°ë˜ëŠ” ë§ˆë²•ì„ ë³´ê²Œ ë ê²ë‹ˆë‹¤. ğŸ™ƒ

```js
const outerFn = async () => {
  const val = await new Promise((resolve) => setTimeout(resolve, 1000)).then(
    () => 123
  );
  return await Promise.resolve(val).then((v) => 3 * v);
};

outerFn().then((val) => console.log(val));
```

## ì €ë²ˆ ì„¤ëª…ì˜ ì½”ë“œ ì°¨ì´ì ê³¼ ê³µí†µì 

### ì°¨ì´ì 
```js:ì €ë²ˆ-í¬ìŠ¤íŠ¸
const outerFn = /*#__PURE__*/ (function () {
  var _ref = _asyncToGenerator(function* () {
    const val = yield new Promise((resolve) => setTimeout(resolve, 1000)).then(
      () => 123
    );
    return yield Promise.resolve(val).then((v) => 3 * v);
  });
  return function outerFn() {
    return _ref.apply(this, arguments);
  };
})();
```

```js:ì´ë²ˆ-í¬ìŠ¤íŠ¸
var outerFn = /*#__PURE__*/ (function () {
  var _ref = _asyncToGenerator(
    /*#__PURE__*/ _regeneratorRuntime().mark(function _callee() {
      var val;
      return _regeneratorRuntime().wrap(function _callee$(_context) {
        while (1) {
          switch ((_context.prev = _context.next)) {
            case 0:
              _context.next = 2;
              return new Promise(function (resolve) {
                return setTimeout(resolve, 1000);
              }).then(function () {
                return 123;
              });
            case 2:
              val = _context.sent;
              _context.next = 5;
              return Promise.resolve(val).then(function (v) {
                return 3 * v;
              });
            case 5:
              return _context.abrupt("return", _context.sent);
            case 6:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    })
  );
  return function outerFn() {
    return _ref.apply(this, arguments);
  };
})();
```
ìœ„ìª½ ì½”ë“œì™€ ì•„ë˜ìª½ ì½”ë“œê°€ ë§ì´ ë‹¤ë¥´ì£ ? ìœ„ ì½”ë“œëŠ” ì €ë²ˆ í¬ìŠ¤íŠ¸ì— ì‘ì„±ëœ ì½”ë“œë¡œ, `_asyncToGenerator` í•¨ìˆ˜ì˜ ì¸ìë¡œ ì œë„ˆë ˆì´í„°ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ ì•„ë˜ìª½ ì½”ë“œëŠ” ì œë„ˆë ˆì´í„° ëŒ€ì‹  `_regeneratorRuntime` í•¨ìˆ˜ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¬´í•œ ë£¨í”„ì™€ switch ë¬¸ë„ ë³´ì´ë„¤ìš”. ì´ê²Œ ë­˜ê¹Œìš”? ğŸ¤”

### ê³µí†µì 
```js showLineNumbers
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }
  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function () {
    var self = this,
      args = arguments;
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);

      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }

      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
      }

      _next(undefined);
    });
  };
}
...
outerFn().then(function (val) {
  return console.log(val);
});
```
`asyncGeneratorStep`ê³¼ `_asyncToGenerator` í•¨ìˆ˜ëŠ” ì €ë²ˆ ì„¤ëª…ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ë‹¤ë§Œ ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ë° ìˆì–´ì„œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. ì €ë²ˆ ì„¤ëª…ì˜ ê²½ìš° 3ë²ˆ ë¼ì¸ì—ì„œ ì œë„ˆë ˆì´í„°ì˜ `next` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆì—ˆìŠµë‹ˆë‹¤. í›„ì— ìì„¸í•˜ê²Œ ì„¤ëª…í•˜ê² ì§€ë§Œ ES5 ë¬¸ë²•ìœ¼ë¡œ ë³€í™˜ëœ ì´ ì½”ë“œì—ì„œëŠ”, 3ë²ˆ ë¼ì¸ì„ í†µí•´ `_regeneratorRuntime` í•¨ìˆ˜ì—ì„œ ë§Œë“¤ì–´ì¤€ `generator` ê°ì²´ì˜ `next` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë³¸ê²©ì ìœ¼ë¡œ ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë‚˜ê°€ ë´…ì‹œë‹¤.

## `_regeneratorRuntime` í•¨ìˆ˜
`_asyncToGenerator` í•¨ìˆ˜ì˜ ì¸ìë¥¼ ìœ„í•´ í˜¸ì¶œë˜ëŠ”, ì´ë²ˆ ì„¤ëª…ì˜ í•µì‹¬ì¸ `_regeneratorRuntime` í•¨ìˆ˜ì…ë‹ˆë‹¤. ë§¤ìš° ë³µì¡í•˜ê³  ê¸¸ê¸° ë•Œë¬¸ì— ì œê°€ í•µì‹¬ì´ë¼ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ë“¤ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ìƒëµí•˜ì—¬ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìƒëµëœ ë¶€ë¶„ë“¤ì´ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ì§ì ‘ ë¶„ì„í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”!
```js showLineNumbers
function _regeneratorRuntime() {
  "use strict";
  _regeneratorRuntime = function _regeneratorRuntime() {
    return exports;
  };
  var exports = {},
    defineProperty =
      Object.defineProperty ||
      function (obj, key, desc) {
        obj[key] = desc.value;
      };

  ...
  var ContinueSentinel = {};

  function Generator() {}

  function GeneratorFunction() {}

  function GeneratorFunctionPrototype() {}

  var IteratorPrototype = {};
  ...
  var Gp =
    (GeneratorFunctionPrototype.prototype =
    Generator.prototype =
      Object.create(IteratorPrototype));
  ...
  return (
    (GeneratorFunction.prototype = GeneratorFunctionPrototype),
    defineProperty(Gp, "constructor", {
      value: GeneratorFunctionPrototype,
      configurable: !0,
    }),
    defineProperty(GeneratorFunctionPrototype, "constructor", {
      value: GeneratorFunction,
      configurable: !0,
    }),
    ...,
    exports
  );
```
24~27ë²ˆ ë¼ì¸ì„ ìˆ˜í–‰í•˜ë©´ì„œ `Generator`, `GeneratorFunction`, `GeneratorFunctionPrototype`, `IteratorPrototype`, `Gp` ê°ì²´ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.^[ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” í•¨ìˆ˜ë„ ê³§ ê°ì²´ì´ë¯€ë¡œ 5ê°œ ëª¨ë‘ ê°ì²´ë¼ê³  í‘œí˜„í–ˆìŠµë‹ˆë‹¤.]^[`Object.create(obj)`ëŠ” objë¥¼ `__proto__`ë¡œ ê°€ì§€ëŠ” ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ return í•´ì¤ë‹ˆë‹¤. **objë¥¼ `prototype`ìœ¼ë¡œ ê°€ì§€ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤!** ìì„¸í•œ ë‚´ìš©ì€ [MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/create)ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.]

![28ë²ˆ ë¼ì¸ì—ì„œ ê°ì²´ë“¤ê°„ì˜ ê´€ê³„](https://i.imgur.com/shw2UIl.png,https://i.imgur.com/VlgLTXG.png)

ê·¸ë¦¬ê³  30~38ë²ˆ ë¼ì¸ì„ ìˆ˜í–‰í•˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ë¡œ ë°œì „í•©ë‹ˆë‹¤.

![39ë²ˆ ë¼ì¸ì—ì„œ ê°ì²´ë“¤ê°„ì˜ ê´€ê³„](https://i.imgur.com/vQJJ7Cg.png,https://i.imgur.com/cUr5o85.png)

ë§ˆì§€ë§‰ìœ¼ë¡œ `exports` ê°ì²´ë¥¼ return í•´ì¤ë‹ˆë‹¤.

<Alert type="info">
  ```js showLineNumbers {3-5}
  function _regeneratorRuntime() {
    "use strict";
    _regeneratorRuntime = function _regeneratorRuntime() {
      return exports;
    };
    var exports = {},
    ...
    return (
      ...,
      exports
    );
}
  ```
  3~5ë²ˆ ë¼ì¸ë„ ë°°ìš¸ì ì´ ìˆëŠ” ì½”ë“œë¼ê³  ìƒê°í•©ë‹ˆë‹¤. `_regeneratorRuntime` í•¨ìˆ˜ë¥¼ ì²˜ìŒ í˜¸ì¶œí•˜ë©´ ìˆ˜ë°±ì¤„ì— ê±¸ì³ì„œ `exports` ê°ì²´ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  `_regeneratorRuntime` í•¨ìˆ˜ë¥¼ ì¬í˜¸ì¶œí–ˆì„ ë•Œ, `exports` ê°ì²´ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì´ ì•„ë‹Œ ê¸°ì¡´ì˜ ì„¤ì •ë˜ì–´ìˆë˜ `exports` ê°ì²´ë¥¼ returní•´ì£¼ë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
</Alert>

ê°„ë‹¨í•˜ê²Œ `_regeneratorRuntime` í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ë¬´ì‘ì • ì½”ë“œë¥¼ ì‚´í´ë³´ì•„ì„œ ì´ í•¨ìˆ˜ê°€ ë­”ê°€ ì‹¶ìœ¼ì‹œì£ ? ì´ í•¨ìˆ˜ë¥¼ ì™œ ì‚´í´ë³´ì•˜ëŠ”ì§€ ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

```js showLineNumbers {3,5}
var outerFn = /*#__PURE__*/ (function () {
  var _ref = _asyncToGenerator(
    /*#__PURE__*/ _regeneratorRuntime().mark(function _callee() {
      var val;
      return _regeneratorRuntime().wrap(function _callee$(_context) {
        ...
      }, _callee);
    })
  );
  return function outerFn() {
    return _ref.apply(this, arguments);
  };
})();
```
ì €ë²ˆ ì„¤ëª…ì—ì„œ ì œë„ˆë ˆì´í„°ê°€ ìˆë˜ ìë¦¬ì— `_regeneratorRuntime`, `mark`, `_callee`, `wrap`, `_callee$` ë¼ëŠ” ê²ƒë“¤ì´ ë³´ì…ë‹ˆë‹¤. ì•„ë§ˆ ì´ í•¨ìˆ˜ë“¤ë¡œ ì œë„ˆë ˆì´í„°ë¥¼ í‰ë‚´ë‚´ê³  ìˆì„ ê²ƒì…ë‹ˆë‹¤. ìœ„ì—ì„œ ì‚´í´ë³´ì•„ì„œ `_regeneratorRuntime()`ì„ í˜¸ì¶œí•˜ë©´ ìˆ˜ë°±ì¤„ì— ê±¸ì³ ì„¤ì •ëœ `exports` ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ê²ƒì€ ì•Œê² ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ `mark`ì™€ `wrap`ì€ ì–´ë–¤ ì¼ì„ í•´ì£¼ëŠ”ì§€ ëª¨ë¥´ê² ë„¤ìš”. ì´ í•¨ìˆ˜ë“¤ì´ ë¬´ì—‡ì„ í•˜ëŠ”ì§€ë„ ì•Œì•„ë³´ë„ë¡í•˜ì£ .

### mark
```js showLineNumbers {8,9,11}
function _regeneratorRuntime() {
  ...
  return (
    ...
    (exports.mark = function (genFun) {
      return (
        Object.setPrototypeOf
          ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype)
          : ((genFun.__proto__ = GeneratorFunctionPrototype),
            define(genFun, toStringTagSymbol, "GeneratorFunction")),
        (genFun.prototype = Object.create(Gp)),
        genFun
      );
    }),
    ...
  );
}
```
7~10ë²ˆ ë¼ì¸ì—ì„œ 3í•­ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ì–´ë–¤ ê²½ìš°ë“ ì§€ ê°„ì— `genFun`ì˜ **\_\_proto__**ë¡œ `GeneratorFunctionPrototype`ì„ ì„¤ì •í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤. `genFun`ì—ëŠ” `_callee`ê°€ ë“¤ì–´ì˜¤ê¸° ë•Œë¬¸ì— ê²°êµ­ì—ëŠ” `_callee` ê°ì²´(= í•¨ìˆ˜)ì˜ **\_\_proto__**ëŠ” `GeneratorFunctionPrototype`ì´ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  11ë²ˆ ë¼ì¸ì—ì„œ `Gp`ë¥¼ __proto__ë¡œ ê°€ì§€ëŠ” ê°ì²´(ì•„ë˜ ê·¸ë¦¼ì—ì„œ â“)ë¥¼ `_callee`ì˜ **prototype**ìœ¼ë¡œ í• ë‹¹í•´ì¤ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ `_callee`(= `genFun`)ë¥¼ return í•´ì¤ë‹ˆë‹¤. ì´ ê³¼ì •ì„ ê±°ì¹˜ë©° ê°ì²´ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ë¡œ ë°œì „í•©ë‹ˆë‹¤.

![mark ì´í›„ ê´€ê³„](https://i.imgur.com/B1SY9hf.png,https://i.imgur.com/atYVEhS.png)

### wrap
```js showLineNumbers {4-6}
function _regeneratorRuntime() {
  ...
  function wrap(innerFn, outerFn, self, tryLocsList) {
    var protoGenerator =
        outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,
      generator = Object.create(protoGenerator.prototype),
      context = new Context(tryLocsList || []);
    return (
      defineProperty(generator, "_invoke", {
        value: makeInvokeMethod(innerFn, self, context),
      }),
      generator
    );
  }
  ...
}
```
`wrap` í•¨ìˆ˜ì˜ `innerFn`ê³¼ `outerFn`ì€ ê°ê° `_callee$`ì™€ `_callee`ì…ë‹ˆë‹¤. `_callee`(= `outerFn`)ì˜ prototypeì€ `mark` í•¨ìˆ˜ë¥¼ í†µí•´ â“ ê°ì²´ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— 5ë²ˆ ë¼ì¸ì˜ ì¡°ê±´ë¬¸ì€ trueê°€ ë©ë‹ˆë‹¤.^[`a instanceof b`ëŠ” a.\_\_proto__ë¶€í„° ì‹œì‘í•˜ì—¬ **\_\_proto__** ë¥¼ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë©° `b.prototype`ê³¼ ë™ì¼í•œì§€ ë¹„êµí•©ë‹ˆë‹¤. ë§Œì•½ `a.__proto__ === b.prototype`ì´ falseë¼ë©´, ë‹¤ìŒì—” `a.__proto__.__proto__ === b.prototype`ì„ í™•ì¸í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì„ `a.__proto__.__proto__.â‹¯.__proto__`ê°€ nullì´ ë  ë•Œê¹Œì§€ ë°˜ë³µí•©ë‹ˆë‹¤. ì¤‘ê°„ì— í•œ ë²ˆì´ë¼ë„ trueì¸ ê²½ìš° trueë¥¼, nullì´ ë  ë•Œê¹Œì§€ ê³„ì† falseì˜€ë‹¤ë©´ falseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.] ë”°ë¼ì„œ `protoGenerator`ëŠ” `_callee`(= `outerFn`)ê°€ ë˜ê³ , `_callee`ì˜ prototypeì€ â“ ê°ì²´ì´ê¸° ë•Œë¬¸ì—, 6ë²ˆ ë¼ì¸ì—ì„œ `generator`ëŠ” â“ ê°ì²´ë¥¼ __proto__ë¡œ ê°€ì§€ëŠ” ê°ì²´ê°€ ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  returnë¬¸ì—ì„œ `generator._invoke`ì— í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ `generator`ë¥¼ return í•´ì¤ë‹ˆë‹¤. (`makeInvokeMethod`ëŠ” í•¨ìˆ˜ë¥¼ return í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë‚˜ì¤‘ì— ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.) ì´ ê³¼ì •ì„ ê±°ì¹˜ë©´ì„œ ê°ì²´ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ë¡œ ë°œì „í•©ë‹ˆë‹¤.

![wrap ì´í›„ ê´€ê³„](https://i.imgur.com/HUxMoIR.png,https://i.imgur.com/yVkz3lS.png)

ë‹¤ì†Œ ë³µì¡í•˜ì£ ? í•˜ì§€ë§Œ ì´ì œ ë” ì´ìƒ ëŠ˜ì–´ë‚  ê´€ê³„ëŠ” ì—†ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  `generator` ê°ì²´ì™€ `Gp` ê°ì²´ì˜ ê´€ê³„ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤! ì´ ê´€ê³„ë§Œ ì˜ ê¸°ì–µí•˜ê³  ê³„ì…”ë„ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆì„ê±°ì—ìš”.

## ì •ë¦¬
```js showLineNumbers
function _asyncToGenerator(fn) {
  return function () {
    ...
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);
      ...
    });
  };
}

var outerFn = /*#__PURE__*/ (function () {
  var _ref = _asyncToGenerator(
    /*#__PURE__*/ _regeneratorRuntime().mark(function _callee() {
      var val;
      return _regeneratorRuntime().wrap(function _callee$(_context) {
        ...
      }, _callee);
    })
  );
  return function outerFn() {
    return _ref.apply(this, arguments);
  };
})();
```

1. `_regeneratorRuntime` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì œë„ˆë ˆì´í„°ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì´ˆê¸° ì„¤ì •ì„ í•©ë‹ˆë‹¤.
2. `mark` í•¨ìˆ˜ëŠ” ì¸ìë¡œ ë°›ì€ `_callee` í•¨ìˆ˜ì˜ __proto__ì™€ prototypeì„ ì´ˆê¸°í™”ë¥¼ í•´ì£¼ê³ , `_callee`ë¥¼ ë‹¤ì‹œ return í•´ì¤ë‹ˆë‹¤.
3. `_asyncToGenerator` í•¨ìˆ˜ëŠ” `_regenerator().mark(...)`ë¥¼ í†µí•´ ì „ì²˜ë¦¬ëœ `_callee` í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ìŠµë‹ˆë‹¤.
4. 5ë²ˆ ë¼ì¸ì—ì„œ `fn` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì¦‰, ì „ì²˜ë¦¬ëœ `_callee` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
5. `_callee`ì˜ return ê°’ì—ì„œ `wrap` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” `_callee$` í•¨ìˆ˜ê°€ ì œë„ˆë ˆì´í„°ì²˜ëŸ¼ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ `_invoke` í•¨ìˆ˜ë¥¼ ê°€ì§„ `generator` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ return í•´ì¤ë‹ˆë‹¤.
6. 4~5ë²ˆì„ ìˆ˜í–‰í•˜ë©´ì„œ 5ë²ˆ ë¼ì¸ì˜ `gen`ì—ëŠ” `generator` ê°ì²´ê°€ ë‹´ê¸°ê²Œ ë©ë‹ˆë‹¤.

```js showLineNumbers
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  ...
  var info = gen[key](arg);
  ...
}

function _asyncToGenerator(fn) {
  return function () {
    ...
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);

      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }
      ...
      _next(undefined);
    });
  };
}
```
7. 17ë²ˆ ë¼ì¸ â†’ 14ë²ˆ ë¼ì¸ì„ í†µí•´ `generator`(= `gen`)ì„ ì¸ìë¡œ ì£¼ì–´ `asyncGeneratorStep` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
8. `key`ë¥¼ nextë¡œ í•˜ì—¬ `asyncGeneratorStep` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆìœ¼ë¯€ë¡œ, 3ë²ˆ ë¼ì¸ì—ì„œ `generator.next`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

## ì•„ì‰½ì§€ë§Œ ë‹¤ìŒí¬ìŠ¤íŠ¸ê¹Œì§€...
ì§€ê¸ˆê¹Œì§€ì˜ íë¦„ ì¤‘ì—ëŠ” `generator.next` í•¨ìˆ˜ë¥¼ ì •ì˜í•œ ì ì´ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í˜¸ì¶œí•˜ê³  ìˆì£ . ì´ê²Œ ì–´ë–»ê²Œ ê°€ëŠ¥í• ê¹Œìš”? ì‚¬ì‹¤ ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œ async/await ë™ì‘ì›ë¦¬í¸ì„ ë§ˆë¬´ë¦¬í•˜ë ¤ê³  í–ˆëŠ”ë° ìƒê°ë³´ë‹¤ ë§ì´ ê¸¸ì–´ì§€ë„¤ìš”. í•œ í˜¸í¡ì— ëë‚´ê³  ì‹¶ì—ˆëŠ”ë° ì¢€ ì•„ì‰½ìŠµë‹ˆë‹¤... ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œ íšŒìˆ˜í•˜ì§€ ëª»í•œ ë–¡ë°¥ì„ íšŒìˆ˜í•˜ê³  ì´ í¸ì„ ë§ˆë¬´ë¦¬í•˜ê² ìŠµë‹ˆë‹¤! ê°€ëŠ¥í•˜ë©´ ì´ í¬ìŠ¤íŠ¸ë¥¼ ì½ê³  ë°”ë¡œ ë³´ì‹œëŠ”ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤ ğŸ™ƒ

**ì˜¤íƒ€ ë° ì˜¤ë¥˜ ì§€ì ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤!**